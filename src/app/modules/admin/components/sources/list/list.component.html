<div class="list-container">
  <div class="list-header">
    <div class="header-titles">
      <h1>Sources & Ingest</h1>
      <p class="subtitle">Manage data sources, ingestion status, and processing queues.</p>
    </div>
    <button mat-flat-button class="add-source-btn">
      <mat-icon>add</mat-icon>
      Add Source
    </button>
  </div>

  <div class="table-card mat-elevation-z1">
    <div class="search-bar">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        class="search-input"
        placeholder="Search by name, type, status..."
        [(ngModel)]="searchTerm"
        (input)="applyFilter()"
        (keyup.escape)="clearSearch()" />
      @if (searchTerm) {
        <button mat-icon-button class="clear-btn" (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </div>

    <table mat-table [dataSource]="dataSource" matSort class="full-width-table">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Source</th>
        <td mat-cell *matCellDef="let element">
          <div class="source-cell">
            <span class="source-title">{{ element.name }}</span>
            <span class="source-subtitle">{{ element.type }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let element">
          <div class="status-badge" [ngClass]="getStatusClass(element.status)">
            <span class="status-dot"></span>
            {{ element.status }}
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="records">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Records Ingested (Last 24h)</th>
        <td mat-cell *matCellDef="let element">{{ element.recordsIngested }}</td>
      </ng-container>

      <ng-container matColumnDef="queue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Queue Depth</th>
        <td mat-cell *matCellDef="let element">{{ element.queueDepth }}</td>
      </ng-container>

      <ng-container matColumnDef="health">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Health</th>
        <td mat-cell *matCellDef="let element">
          <mat-progress-bar
            mode="determinate"
            [value]="element.healthValue"
            class="health-progress"></mat-progress-bar>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button class="action-btn" [matMenuTriggerFor]="itemMenu">
            <mat-icon>more_vert</mat-icon>
          </button>
          
          <mat-menu #itemMenu="matMenu" class="compact-list-menu" xPosition="before">
            <button mat-menu-item (click)="editSource(element)">
              <mat-icon>edit</mat-icon><span>Edit Source</span>
            </button>
            <button mat-menu-item (click)="inspectSource(element)">
              <mat-icon>search</mat-icon><span>Inspect Source</span>
            </button>
            <button mat-menu-item (click)="viewLogs(element)">
              <mat-icon>history</mat-icon><span>View Logs</span>
            </button>
            <button mat-menu-item (click)="syncNow(element)">
              <mat-icon>sync</mat-icon><span>Sync Now</span>
            </button>
            <div class="menu-divider"></div>
            <button mat-menu-item (click)="pauseIngestion(element)">
              <mat-icon>pause_circle</mat-icon><span>Pause / Disable</span>
            </button>
            <button mat-menu-item (click)="downloadSchema(element)">
              <mat-icon>description</mat-icon><span>Download Schema</span>
            </button>
            <button mat-menu-item (click)="clearCache(element)">
              <mat-icon>refresh</mat-icon><span>Clear Cache</span>
            </button>
            <div class="menu-divider danger-divider"></div>
            <button mat-menu-item (click)="removeSource(element)" class="delete-action">
              <mat-icon>delete_forever</mat-icon><span>Remove Source</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 20, 30]"
      showFirstLastButtons
      aria-label="Select page of sources">
    </mat-paginator>
  </div>
</div>