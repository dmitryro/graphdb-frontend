@use 'src/scss/variables' as *;

// Z-index ladder
$z-tabs: 900;
$z-search: 800;
$z-filters: 700;
$z-table-header: 600;
$z-overlay: 2000;

// Main container
.normalization-main-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  width: 100%;
  background-color: var(--bg-color);
  color: var(--text-main);
  position: relative;
  z-index: 0;
}

// Header
.normalization-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 24px 40px;
  border-bottom: 1px solid var(--border-color);
  background-color: var(--bg-color) !important;
  position: static;
  z-index: auto;

  .breadcrumb-area {
    .breadcrumb {
      color: var(--text-main);
      opacity: 0.5;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .title-row h1 {
      margin: 0;
      font-size: 26px;
      font-weight: 500;
      color: var(--text-main);
    }
    .subtitle {
      color: var(--text-main);
      opacity: 0.6;
      margin: 4px 0 0;
      font-size: 14px;
    }
  }

  .workspace-area .workspace-select {
    width: 180px;

    ::ng-deep {
      .mat-mdc-text-field-wrapper {
        background-color: #e18840 !important;
        border-radius: 6px;
        height: 48px;
        display: flex;
        align-items: center;
      }
      .mat-mdc-form-field-flex,
      .mat-mdc-form-field-infix,
      .mat-mdc-select,
      .mat-mdc-select-trigger,
      .mat-mdc-select-value {
        background-color: transparent !important;
      }
      .mat-mdc-form-field-infix {
        padding: 12px 0;
        border: none !important;
      }
      .mat-mdc-select-value-text,
      .mat-mdc-select-arrow {
        color: white !important;
        font-weight: 600;
      }
      .mat-mdc-select-arrow svg {
        fill: white !important;
      }
      .mdc-notched-outline,
      .mdc-notched-outline__leading,
      .mdc-notched-outline__notch,
      .mdc-notched-outline__trailing {
        display: none !important;
        border: none !important;
      }
    }
  }
}

// Table card
.table-card {
  margin: 24px 40px;
  background: var(--surface-color);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  position: relative;
  z-index: 1;
}

// Tabs section
.tabs-section {
  border-bottom: 1px solid var(--border-color);
  background-color: var(--surface-color) !important;
  position: static;
  z-index: $z-tabs;
  border-radius: 12px 12px 0 0;

  .normalization-tabs ::ng-deep {
    .mat-mdc-tab-group {
      --mdc-tab-indicator-active-indicator-color: #436d9d;
      --mat-tab-header-active-label-text-color: var(--text-main);
      --mat-tab-header-inactive-label-text-color: var(--text-main);
    }
    .mat-mdc-tab-header {
      padding: 0 24px;
      background-color: var(--surface-color) !important;
      border-radius: 12px 12px 0 0;
    }
    .mat-mdc-tab-labels {
      border: none;
      background-color: var(--surface-color) !important;
    }
    .mat-mdc-tab .mdc-tab__text-label {
      color: var(--text-main) !important;
      opacity: 0.6;
    }
    .mat-mdc-tab.mdc-tab--active .mdc-tab__text-label {
      opacity: 1 !important;
    }
    .mat-mdc-tab-header-pagination-controls-enabled .mat-mdc-tab-header-pagination {
      display: none !important;
    }
  }
}

// Search section
.search-section {
  padding: 16px 24px;
  border-bottom: 1px solid var(--border-color);
  background-color: var(--surface-color) !important;
  position: static;
  z-index: $z-search;

  .search-bar-container {
    display: flex;
    align-items: center;
    gap: 20px;

    .search-box {
      flex: 1;
      display: flex;
      align-items: center;
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0 16px;
      height: 44px;

      .search-icon {
        color: var(--text-main);
        opacity: 0.5;
      }
      .search-input {
        flex: 1;
        border: none;
        outline: none;
        background: transparent;
        color: var(--text-main);
        padding: 8px;
        font-size: 14px;

        &::placeholder {
          color: var(--text-main);
          opacity: 0.4;
        }
      }
    }

    .add-source-btn {
      background-color: #436d9d !important;
      color: white !important;
      height: 44px;
      padding: 0 24px;
      border-radius: 8px;
      font-weight: 600;
      white-space: nowrap;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

      mat-icon {
        margin-right: 8px;
        font-size: 20px;
        width: 20px;
        height: 20px;
      }
    }
  }
}

// Filter actions
.filter-actions {
  padding: 10px 24px;
  display: flex;
  gap: 12px;
  background: var(--surface-color) !important;
  border-bottom: 1px solid var(--border-color);
  position: static;
  z-index: $z-filters;

  .filter-dropdown {
    color: var(--text-main);
    border: 1px solid var(--border-color);
    background: var(--surface-color);
    height: 34px;
    font-size: 13px;
    border-radius: 6px;

    mat-icon {
      font-size: 18px;
      width: 18px;
      height: 18px;
    }
    .chevron {
      opacity: 0.5;
      margin-left: 4px;
    }
    &:hover {
      background: rgba(128, 128, 128, 0.05);
    }
  }
}

// Table
.full-width-table {
  width: 100%;
  background: transparent !important;
  position: relative;
  z-index: 0;

  th {
    color: var(--text-main);
    opacity: 0.7;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 16px 24px;
    background: var(--surface-color) !important;
    letter-spacing: 0.5px;
    position: static;
    z-index: $z-table-header;
  }

  td {
    color: var(--text-main);
    padding: 16px 24px;
    border-bottom: 1px solid var(--border-color);
    font-size: 14px;
    position: relative;
    z-index: 0;

    &.primary-text {
      font-weight: 500;

      code {
        background: rgba(128, 128, 128, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Roboto Mono', monospace;
        font-size: 13px;
        color: #436d9d;
      }
    }
  }

  tr:hover td {
    background-color: rgba(128, 128, 128, 0.02);
  }
}

// Status pills
.status-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;

  mat-icon {
    font-size: 14px;
    width: 14px;
    height: 14px;

    &.check_circle {
      color: #2ecc71;
    }
    &.history {
      color: #3498db;
    }
  }

  &.active {
    background: rgba(46, 204, 113, 0.15);
    color: #2ecc71;
  }
  &.deployed {
    background: rgba(52, 152, 219, 0.15);
    color: #3498db;

    &.latest {
      border: 1px solid #3498db;
      box-shadow: 0 0 8px rgba(52, 152, 219, 0.2);
    }
  }
  &.deprecated {
    background: rgba(230, 126, 34, 0.15);
    color: #e67e22;
  }
  &.draft {
    background: rgba(149, 165, 166, 0.15);
    color: #95a5a6;
  }
  &.production {
    border: 1px solid #2ecc71;
  }
  &.staging {
    border: 1px solid #3498db;
  }
  &.development {
    border: 1px solid #9b59b6;
  }
}

// Versions tab
.version-controls-row {
  display: flex;
  align-items: center;
  padding: 12px 24px;
  border-bottom: 1px solid var(--border-color);
  background: var(--surface-color);

  .search-box-version {
    flex: 1;
    max-width: 600px;
    display: flex;
    align-items: center;
    background: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 6px 12px;
    font-size: 13px;

    mat-icon {
      font-size: 18px;
      width: 18px;
      height: 18px;
      opacity: 0.5;
      margin-right: 8px;
    }
    input {
      border: none;
      background: transparent;
      flex: 1;
      color: var(--text-main);
      outline: none;
    }
    .v-divider {
      margin: 0 12px;
      color: var(--border-color);
    }
  }

  .version-meta-actions {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 8px;

    .v-count {
      color: var(--text-main);
      opacity: 0.5;
      margin-right: 12px;
      font-size: 13px;
    }
    button mat-icon {
      opacity: 0.6;
    }
  }
}

.version-filters-bar {
  display: flex;
  align-items: center;
  padding: 10px 24px;
  border-bottom: 1px solid var(--border-color);
  background: var(--surface-color);
  font-size: 13px;

  .spacer {
    flex: 1;
  }
}

// Timeline
.timeline-container {
  padding: 24px;
  background: var(--bg-color);
  min-height: 400px;

  .timeline-card {
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);

    &:last-child {
      margin-bottom: 0;
    }

    .card-header {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: rgba(128, 128, 128, 0.02);
      border-bottom: 1px solid var(--border-color);
      gap: 12px;

      .avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
      }
      .rel-time {
        font-weight: 700;
        color: var(--text-main);
        font-size: 13px;
      }
      .abs-time {
        color: var(--text-main);
        opacity: 0.5;
        font-size: 12px;
      }
      .hash {
        background: rgba(67, 109, 157, 0.1);
        color: #436d9d;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 11px;
      }
      .author {
        font-size: 13px;
        font-weight: 500;
        color: #436d9d;
      }

      .header-actions {
        display: flex;
        gap: 12px;
        color: var(--text-main);
        opacity: 0.4;

        mat-icon {
          font-size: 18px;
          width: 18px;
          height: 18px;
          cursor: pointer;
          transition: opacity 0.2s;

          &:hover {
            opacity: 1;
            color: #436d9d;
          }
        }
        .toggle {
          opacity: 0.8;
        }
      }
    }

    .card-body {
      padding-bottom: 8px;
    }
  }
}

.timeline-event {
  display: flex;
  padding: 16px 20px;
  gap: 12px;

  .event-icon {
    &.added {
      color: #2ecc71;
    }
    mat-icon {
      font-size: 20px;
    }
  }

  .event-text {
    flex: 1;
    font-size: 14px;
    line-height: 1.4;

    .bold {
      font-weight: 700;
    }
    .subject {
      font-weight: 700;
      text-decoration: underline;
      color: #436d9d;
      cursor: pointer;
    }
    .ver {
      opacity: 0.5;
      margin-left: 4px;
      font-size: 12px;
    }
    .muted {
      opacity: 0.6;
    }
    .sub-detail {
      margin-top: 4px;
      font-size: 12px;
      opacity: 0.7;
    }
  }

  .event-time {
    color: var(--text-main);
    opacity: 0.4;
    font-size: 12px;
    white-space: nowrap;
  }
}

.tree-container {
  padding-left: 54px;
  padding-bottom: 16px;
  position: relative;

  .tree-line {
    position: absolute;
    left: 30px;
    top: -10px;
    bottom: 24px;
    width: 2px;
    background: var(--border-color);

    &::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 14px;
      height: 2px;
      background: var(--border-color);
    }
  }

  .tree-node {
    display: flex;
    align-items: center;
    background: rgba(128, 128, 128, 0.05);
    padding: 10px 16px;
    border-radius: 6px;
    gap: 12px;
    font-size: 13px;
    border: 1px solid transparent;
    transition: all 0.2s ease;

    &:hover {
      border-color: var(--border-color);
      background: rgba(128, 128, 128, 0.08);
      transform: translateX(4px);
    }

    mat-icon {
      font-size: 18px;
      width: 18px;
      height: 18px;
      opacity: 0.6;
    }
    .node-title {
      font-weight: 500;
    }

    .node-tag {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 800;
      text-transform: uppercase;

      &.rule {
        background: #e2e8f0;
        color: #475569;
      }
      &.mapping {
        background: #dbeafe;
        color: #1e40af;
      }
      &.model {
        background: #fef3c7;
        color: #92400e;
      }
    }

    .node-time {
      opacity: 0.4;
      font-size: 11px;
    }
    .check {
      color: #2ecc71;
      opacity: 1;
    }
    .info {
      color: #436d9d;
      opacity: 1;
    }
  }
}

.timeline-row-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  border-top: 1px solid var(--border-color);
  gap: 12px;
  font-size: 13px;

  .edit-icon {
    color: #3498db;
    font-size: 18px;
  }
  .type-icon {
    font-size: 18px;
    opacity: 0.6;

    &.added {
      color: #2ecc71;
      opacity: 1;
    }
  }
  .mini-avatar {
    width: 20px;
    height: 20px;
    border-radius: 50%;
  }
  .label {
    font-weight: 700;
  }
  .subject {
    font-weight: 700;
    color: #436d9d;
  }
  .muted {
    opacity: 0.5;
  }
  .meta {
    font-size: 11px;
    opacity: 0.5;
    font-style: italic;
  }
  .row-time {
    margin-left: auto;
    opacity: 0.4;
    font-size: 11px;
  }
  .info {
    font-size: 16px;
    opacity: 0.4;
  }
}

// Material overlays
::ng-deep {
  .cdk-overlay-container,
  .cdk-overlay-pane {
    z-index: $z-overlay !important;
  }

  .mat-mdc-menu-panel,
  .mat-mdc-select-panel,
  .compact-list-menu {
    z-index: $z-overlay !important;
    background-color: var(--surface-color) !important;
    border: 1px solid var(--border-color) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.28) !important;
  }

  .compact-list-menu {
    min-width: 200px !important;

    .mat-mdc-menu-item {
      color: var(--text-main) !important;
      font-size: 13px !important;
      min-height: 40px !important;

      mat-icon {
        color: var(--text-main);
        opacity: 0.7;
        margin-right: 8px !important;
        font-size: 18px;
        width: 18px;
        height: 18px;
      }

      &:hover {
        background: rgba(128, 128, 128, 0.1) !important;
      }

      &.delete-action {
        color: #f44336 !important;
        mat-icon {
          color: #f44336 !important;
          opacity: 1;
        }
      }
    }

    .menu-divider {
      height: 1px;
      background: var(--border-color);
      margin: 4px 0;

      &.danger-divider {
        background: rgba(244, 67, 54, 0.2);
      }
    }
  }

  .mat-mdc-paginator {
    background: var(--surface-color) !important;
    color: var(--text-main) !important;
    border-top: 1px solid var(--border-color);
    padding: 12px 24px !important;
    position: relative;
    z-index: 100;
  }

  .mat-mdc-paginator-container {
    justify-content: flex-end !important;
    padding: 0 8px;
  }

  .mat-sort-header-container {
    display: flex;
    align-items: center;
  }
}

// Datepicker
::ng-deep {
  .cdk-overlay-container {
    z-index: 10000 !important;
  }

  .cdk-overlay-pane,
  .mat-datepicker-popup {
    z-index: 10000 !important;
  }

  .mat-datepicker-content {
    background-color: var(--surface-color, var(--bg-surface, #1e1e1e)) !important;
    color: var(--text-main) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 8px !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
    max-height: 420px !important;
    padding: 16px !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15) !important;

    @media (prefers-color-scheme: dark) {
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5) !important;
    }
  }

  mat-calendar.mat-calendar {
    background: var(--surface-color) !important;
    color: var(--text-main) !important;
    font-family: inherit !important;
    width: 296px !important;
  }

  .mat-calendar-header {
    background: var(--surface-color) !important;
    padding: 8px 16px !important;
  }

  .mat-calendar-controls {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    margin: 4px 0 8px 0 !important;
  }

  button.mat-calendar-period-button {
    color: var(--text-main) !important;
    font-weight: 600 !important;
    font-size: 14px !important;

    .mat-calendar-arrow {
      border-top-color: var(--text-main) !important;
    }

    &:hover {
      background: rgba(128, 128, 128, 0.1) !important;
    }
  }

  button.mat-calendar-previous-button,
  button.mat-calendar-next-button {
    color: var(--text-main) !important;

    &:hover {
      background: rgba(128, 128, 128, 0.1) !important;
    }
  }

  .mat-calendar-content {
    height: 320px !important;
    min-height: 300px !important;
    padding: 0 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    outline: none !important;

    &::-webkit-scrollbar {
      width: 5px;
    }
    &::-webkit-scrollbar-thumb {
      background: #646464;
      border-radius: 10px;
    }
  }

  table.mat-calendar-table {
    width: 100% !important;
    border-spacing: 0 !important;
    border-collapse: collapse !important;
    display: table !important;
  }

  .mat-calendar-table-header tr th {
    color: var(--text-main) !important;
    opacity: 0.6 !important;
    font-size: 11px !important;
    font-weight: 600 !important;
    text-align: center !important;
    padding: 8px 0 !important;
    text-transform: uppercase !important;
  }

  .mat-calendar-body {
    display: table-row-group !important;
    visibility: visible !important;
  }

  .mat-calendar-body-row {
    display: table-row !important;
    height: 40px !important;
  }

  .mat-calendar-body-cell {
    position: relative !important;
    height: 40px !important;
    width: 40px !important;
    text-align: center !important;
    outline: none !important;
    cursor: pointer !important;
    border: none !important;
    visibility: visible !important;

    .mat-calendar-body-cell-content {
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      box-sizing: border-box !important;
      width: 32px !important;
      height: 32px !important;
      line-height: 32px !important;
      border-radius: 50% !important;
      color: var(--text-main) !important;
      background: transparent !important;
      font-size: 13px !important;
      font-weight: 500 !important;
      border: none !important;
      z-index: 2 !important;
      padding: 0 !important;
      text-align: center !important;
    }

    &:not(.mat-calendar-body-disabled):hover {
      .mat-calendar-body-cell-content {
        background-color: rgba(128, 128, 128, 0.15) !important;
      }
    }
  }

  .mat-calendar-body-today:not(.mat-calendar-body-selected) {
    .mat-calendar-body-cell-content {
      border: 2px solid #436d9d !important;
      font-weight: 700 !important;
    }
  }

  .mat-calendar-body-selected,
  .mat-calendar-body-range-start,
  .mat-calendar-body-range-end {
    .mat-calendar-body-cell-content {
      background-color: #436d9d !important;
      color: #ffffff !important;
      font-weight: 700 !important;
    }
  }

  .mat-calendar-body-in-range::before {
    content: '' !important;
    position: absolute !important;
    top: 5% !important;
    left: -5px !important;
    right: -5px !important;
    height: 90% !important;
    background-color: rgba(67, 109, 157, 0.15) !important;
    z-index: 1 !important;
  }

  .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover {
    .mat-calendar-body-cell-content {
      background-color: rgba(128, 128, 128, 0.2) !important;
    }
  }

  mat-month-view {
    display: block !important;
    min-height: 280px !important;
  }

  .mat-calendar,
  .mat-calendar-table,
  .mat-calendar-header,
  .mat-calendar-controls,
  .mat-calendar-body-cell-content,
  .mat-calendar-table-header th,
  .mat-calendar-period-button,
  .mat-calendar-arrow,
  .mat-calendar-body-label,
  button.mat-calendar-previous-button,
  button.mat-calendar-next-button {
    color: #646464 !important;
    fill: #646464 !important;
    border-top-color: #646464 !important;
    opacity: 1 !important;
  }

  @media (prefers-color-scheme: light) {
    .mat-calendar-body-cell-content,
    .mat-calendar-table-header th,
    .mat-calendar-period-button,
    .mat-calendar-arrow,
    button.mat-calendar-previous-button,
    button.mat-calendar-next-button,
    .mat-calendar-content * {
      color: #868a8d !important;
      fill: #868a8d !important;
    }
    .mat-calendar-arrow {
      border-top-color: #868a8d !important;
    }
    .mat-calendar-content::-webkit-scrollbar-thumb {
      background: #868a8d;
    }
  }

  .mat-calendar-body-cell-content *,
  .mat-calendar-table-header th * {
    color: inherit !important;
    fill: inherit !important;
  }
}

.date-range-container {
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;

  input {
    background: transparent !important;
    border: none !important;
    color: var(--text-main) !important;
    font-size: 13px !important;
    width: 85px !important;

    &::placeholder {
      opacity: 0.4 !important;
      color: var(--text-main) !important;
    }
  }

  .mat-date-range-input-separator {
    color: var(--text-main) !important;
    opacity: 0.5 !important;
  }
}

// Datepicker toggle icon & button fixes
::ng-deep {
  .mat-mdc-datepicker-toggle {
    color: #646464 !important;

    .mat-datepicker-toggle-default-icon,
    mat-icon,
    .mdc-icon-button__icon,
    svg,
    path {
      color: #646464 !important;
      fill: #646464 !important;
      opacity: 0.4 !important;
    }

    @media (prefers-color-scheme: light) {
      .mat-datepicker-toggle-default-icon,
      mat-icon,
      .mdc-icon-button__icon,
      svg,
      path {
        color: #868a8d !important;
        fill: #868a8d !important;
      }
    }

    &:hover {
      .mat-datepicker-toggle-default-icon,
      mat-icon,
      svg,
      path {
        opacity: 1 !important;
      }
    }

    button.mdc-icon-button {
      background: transparent !important;
      border: none !important;
      --mdc-icon-button-icon-color: inherit;
    }
  }

  .normalization-main-container {
    .mdc-icon-button svg,
    .mat-icon,
    svg[mat-icon],
    .mat-mdc-datepicker-toggle svg {
      fill: #646464 !important;
      color: #646464 !important;
    }

    @media (prefers-color-scheme: light) {
      .mdc-icon-button svg,
      .mat-icon,
      svg[mat-icon],
      .mat-mdc-datepicker-toggle svg {
        fill: #868a8d !important;
        color: #868a8d !important;
      }
    }

    .add-source-btn {
      font-family: 'Roboto', sans-serif !important;
      letter-spacing: 0.25px !important;

      mat-icon,
      svg,
      path {
        color: white !important;
        fill: white !important;
        opacity: 1 !important;
        font-size: 20px !important;
        width: 20px !important;
        height: 20px !important;
        margin-right: 8px !important;
      }

      &:hover,
      &:active,
      &:focus {
        background-color: #355a8c !important;
        color: white !important;

        mat-icon,
        svg,
        path {
          color: white !important;
          fill: white !important;
        }
      }

      .mdc-button__label {
        color: white !important;
      }
    }
  }

  .mat-mdc-button-base.mat-mdc-icon-button {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;

    .mat-mdc-button-touch-target {
      display: none !important;
    }

    .mdc-icon-button__icon,
    mat-icon,
    svg {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      margin: 0 !important;
      padding: 0 !important;
      line-height: 1 !important;
      width: 100% !important;
      height: 100% !important;
    }
  }

  .mat-datepicker-toggle {
    button.mat-mdc-icon-button {
      width: 40px !important;
      height: 40px !important;
      padding: 0 !important;
    }
  }

  .mat-mdc-date-range-input {
    display: flex !important;
    align-items: center !important;
    min-height: 44px !important;
    padding: 0 12px !important;
    overflow: visible !important;
    gap: 4px;
    width: 100%;
    max-width: 340px;

    .mat-mdc-date-range-input-container {
      display: flex !important;
      align-items: center !important;
      flex: 1 1 auto !important;
      overflow: visible !important;
      min-width: 0;
      gap: 6px;

      .mat-mdc-date-range-input-start-wrapper,
      .mat-mdc-date-range-input-end-wrapper {
        flex: 1 1 45% !important;
        min-width: 110px !important;
        max-width: 150px !important;
        overflow: visible !important;

        input.mat-mdc-date-range-input-inner {
          flex: 1 1 auto !important;
          min-width: 100px !important;
          width: 100% !important;
          padding: 0 6px !important;
          font-size: 13px !important;
          line-height: 1.45 !important;
          color: var(--text-main) !important;
          background: transparent !important;
          border: none !important;
          overflow: visible !important;
          text-overflow: clip !important;
          white-space: nowrap !important;
        }
      }

      .mat-date-range-input-separator {
        flex: 0 0 auto !important;
        min-width: 24px;
        color: var(--text-main) !important;
        opacity: 0.6;
        font-size: 14px;
        margin: 0 4px;
      }
    }

    .mat-mdc-datepicker-toggle {
      margin-left: 4px !important;
      flex: 0 0 auto !important;

      .mdc-icon-button {
        width: 36px !important;
        height: 36px !important;
        padding: 0 !important;
      }
    }

    .clear-date-btn {
      margin-left: 4px;
      flex: 0 0 auto;
    }
  }

  .date-range-container,
  .search-box-version {
    overflow: visible !important;
    min-width: 360px !important;
  }

  .version-controls-row {
    .search-box-version {
      display: flex !important;
      align-items: center !important;
      justify-content: flex-start !important;
      height: 44px !important;
      max-width: 850px !important;
      padding: 0 12px !important;
      border: 1px solid rgba(128, 128, 128, 0.4) !important;
      border-radius: 8px !important;
      overflow: visible !important;
      box-sizing: border-box !important;

      .mat-icon,
      mat-icon[role='img'] {
        flex: 0 0 auto !important;
        font-size: 20px !important;
        height: 20px !important;
        width: 20px !important;
        margin-right: 10px !important;
        display: flex !important;
        align-items: center !important;
      }

      input[type='text'] {
        flex: 1 1 auto !important;
        font-size: 14px !important;
        background: transparent !important;
        border: none !important;
        outline: none !important;
        height: 100% !important;
      }

      .v-divider {
        margin: 0 10px !important;
        height: 18px !important;
        opacity: 0.3 !important;
        display: flex !important;
        align-items: center !important;
      }

      .date-range-container {
        display: flex !important;
        align-items: center !important;
        flex: 0 0 auto !important;
        margin-left: auto !important;

        .mat-date-range-input {
          display: flex !important;
          align-items: center !important;

          .mat-date-range-input-container {
            padding: 0 !important;
            display: flex !important;
            align-items: center !important;
            height: 32px !important;

            .mat-date-range-input-wrapper {
              flex: 0 0 auto !important;
              width: 82px !important;
              height: 32px !important;
              display: flex !important;
              align-items: center !important;

              input.mat-date-range-input-inner {
                height: 32px !important;
                font-size: 12px !important;
                text-align: center !important;
                line-height: 32px !important;
                border-radius: 6px !important;
                background: rgba(128, 128, 128, 0.15) !important;
                padding: 0 6px !important;
                border: none !important;

                &:hover {
                  background: rgba(128, 128, 128, 0.25) !important;
                }
              }
            }

            .mat-date-range-input-separator {
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              width: 24px !important;
              margin: 0 4px !important;
              color: inherit !important;
              font-weight: bold !important;
              opacity: 0.7 !important;
              padding-left: 0.7em;
            }
          }
        }

        .mat-datepicker-toggle {
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          height: 32px !important;
          width: 32px !important;
          margin-left: 12px !important;
          transform: scale(0.8) !important;
        }

        button[aria-label*='Clear'],
        .mat-mdc-icon-button {
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          height: 32px !important;
          width: 32px !important;
          margin: 0 !important;
          transform: scale(0.8) !important;
        }

        padding-right: 8px !important;
      }
    }
  }
}

.models-tab-wrapper {
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  background: transparent !important;

  .filter-date-range {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: -1.45em !important;

    .custom-pill-date {
      ::ng-deep {
        // Kill all default Material styling
        .mat-mdc-form-field-notched-outline,
        .mat-mdc-form-field-focus-indicator,
        .mat-mdc-form-field-subscript-wrapper,
        .mdc-notched-outline,
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
          display: none !important;
        }

        .mat-mdc-text-field-wrapper {
          background: transparent !important;
          padding: 0 !important;
          border: none !important;
          box-shadow: none !important;
        }

        .mat-mdc-form-field-flex {
          align-items: center !important;
          padding: 0 !important;
        }

        .mat-mdc-form-field-infix {
          padding: 0 !important;
          min-height: auto !important;
          width: auto !important;
          border-top: none !important;
        }

        .mat-date-range-input-container {
          padding: 0 !important;
          overflow: visible !important;
          display: flex !important;
          align-items: center !important;
          gap: 0 !important;
          border: none !important;
          outline: none !important;
        }

        // LIGHT MODE - Default styles
        .mat-date-range-input-wrapper {
          border: 1px solid #e0e0e0 !important;
          background: #ffffff !important;
          border-radius: 6px !important;
          height: 32px !important;
          display: flex !important;
          align-items: center !important;
          padding: 0 10px !important;
          transition: background 0.2s ease !important;
          cursor: pointer !important;
          min-width: 80px !important;
          box-sizing: border-box !important;

          &:hover {
            background: #f5f5f5 !important;
          }

          &:focus-within {
            outline: none !important;
            box-shadow: none !important;
          }

          input {
            background: transparent !important;
            border: none !important;
            color: var(--text-main) !important;
            font-size: 13px !important;
            padding: 0 !important;
            width: 100% !important;
            text-align: center !important;
            overflow: visible !important;
            outline: none !important;

            &:focus {
              outline: none !important;
              border: none !important;
              box-shadow: none !important;
            }

            &::placeholder {
              color: var(--text-main) !important;
              opacity: 0.5 !important;
            }
          }
        }

        .mat-date-range-input-separator {
          margin: 0 4px !important;
          display: flex !important;
          align-items: center !important;
          color: var(--text-main) !important;
          font-size: 14px !important;
          opacity: 0.7 !important;
        }

        .mat-datepicker-toggle {
          margin-left: 4px !important;

          .mat-mdc-button-touch-target {
            display: none !important;
          }

          button {
            width: 32px !important;
            height: 32px !important;
            padding: 0 !important;
            min-width: 32px !important;
            background: transparent !important;
            border: none !important;

            .mat-datepicker-toggle-default-icon,
            svg {
              width: 19px !important;
              height: 19px !important;
              font-size: 19px !important;
              fill: #818588 !important;
              opacity: 0.7 !important;
            }
          }
        }

        .clear-date-btn {
          width: 28px !important;
          height: 28px !important;
          padding: 0 !important;
          min-width: 28px !important;
          border-radius: 50% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;

          mat-icon {
            width: 16px !important;
            height: 16px !important;
            font-size: 16px !important;
            fill: #818588 !important;
            opacity: 0.7 !important;
          }
        }
      }
    }
  }
}

// DARK MODE - OUTSIDE of .models-tab-wrapper with maximum specificity
@media (prefers-color-scheme: dark) {
  .models-tab-wrapper {
    .filter-date-range {
      .custom-pill-date {
        ::ng-deep {
          .mat-date-range-input-wrapper {
            border: 1px solid rgba(255, 255, 255, 0.12) !important;
            background: #1e1e1e !important;

            &:hover {
              background: #2e2e2e !important;
            }
          }
        }
      }
    }
  }
}

.mapping-tab-wrapper {
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  background: transparent !important;

  .filter-date-range {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: -1.45em !important;

    .custom-pill-date {
      ::ng-deep {
        // Kill all default Material styling
        .mat-mdc-form-field-notched-outline,
        .mat-mdc-form-field-focus-indicator,
        .mat-mdc-form-field-subscript-wrapper,
        .mdc-notched-outline,
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
          display: none !important;
        }

        .mat-mdc-text-field-wrapper {
          background: transparent !important;
          padding: 0 !important;
          border: none !important;
          box-shadow: none !important;
        }

        .mat-mdc-form-field-flex {
          align-items: center !important;
          padding: 0 !important;
        }

        .mat-mdc-form-field-infix {
          padding: 0 !important;
          min-height: auto !important;
          width: auto !important;
          border-top: none !important;
        }

        .mat-date-range-input-container {
          padding: 0 !important;
          overflow: visible !important;
          display: flex !important;
          align-items: center !important;
          gap: 0 !important;
          border: none !important;
          outline: none !important;
        }

        // LIGHT MODE - Default styles
        .mat-date-range-input-wrapper {
          border: 1px solid #e0e0e0 !important;
          background: #ffffff !important;
          border-radius: 6px !important;
          height: 32px !important;
          display: flex !important;
          align-items: center !important;
          padding: 0 10px !important;
          transition: background 0.2s ease !important;
          cursor: pointer !important;
          min-width: 80px !important;
          box-sizing: border-box !important;

          &:hover {
            background: #f5f5f5 !important;
          }

          &:focus-within {
            outline: none !important;
            box-shadow: none !important;
          }

          input {
            background: transparent !important;
            border: none !important;
            color: var(--text-main) !important;
            font-size: 13px !important;
            padding: 0 !important;
            width: 100% !important;
            text-align: center !important;
            overflow: visible !important;
            outline: none !important;

            &:focus {
              outline: none !important;
              border: none !important;
              box-shadow: none !important;
            }

            &::placeholder {
              color: var(--text-main) !important;
              opacity: 0.5 !important;
            }
          }
        }

        .mat-date-range-input-separator {
          margin: 0 4px !important;
          display: flex !important;
          align-items: center !important;
          color: var(--text-main) !important;
          font-size: 14px !important;
          opacity: 0.7 !important;
        }

        .mat-datepicker-toggle {
          margin-left: 4px !important;

          .mat-mdc-button-touch-target {
            display: none !important;
          }

          button {
            width: 32px !important;
            height: 32px !important;
            padding: 0 !important;
            min-width: 32px !important;
            background: transparent !important;
            border: none !important;

            .mat-datepicker-toggle-default-icon,
            svg {
              width: 19px !important;
              height: 19px !important;
              font-size: 19px !important;
              fill: #818588 !important;
              opacity: 0.7 !important;
            }
          }
        }

        .clear-date-btn {
          width: 28px !important;
          height: 28px !important;
          padding: 0 !important;
          min-width: 28px !important;
          border-radius: 50% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;

          mat-icon {
            width: 16px !important;
            height: 16px !important;
            font-size: 16px !important;
            fill: #818588 !important;
            opacity: 0.7 !important;
          }
        }
      }
    }
  }
}

// DARK MODE - Scoped specifically for Mapping tab
@media (prefers-color-scheme: dark) {
  .mapping-tab-wrapper {
    .filter-date-range {
      .custom-pill-date {
        ::ng-deep {
          .mat-date-range-input-wrapper {
            border: 1px solid rgba(255, 255, 255, 0.12) !important;
            background: #1e1e1e !important;

            &:hover {
              background: #2e2e2e !important;
            }
          }
        }
      }
    }
  }
}

.rules-tab-wrapper {
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  background: transparent !important;

  // --- STATUS PILL STYLES (Matching Mapping Tab) ---
  .status-pill {
    display: inline-flex !important;
    padding: 2px 8px !important;
    border-radius: 4px !important;
    font-size: 11px !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.3px !important;

    &.active {
      background: rgba(46, 125, 50, 0.1) !important;
      color: #2e7d32 !important;
    }
    &.draft {
      background: rgba(158, 158, 158, 0.1) !important;
      color: #9e9e9e !important;
    }
    &.archived,
    &.deprecated {
      background: rgba(211, 47, 47, 0.1) !important;
      color: #d32f2f !important;
    }
  }
  // --- SEVERITY PILL STYLES (4px Rounding to match Status) ---
  .severity-pill {
    display: inline-flex !important;
    align-items: center !important;
    padding: 2px 10px !important;
    border-radius: 4px !important;
    font-size: 12px !important;
    font-weight: 500 !important;
    gap: 6px !important;
    width: fit-content !important;

    .dot {
      width: 6px !important;
      height: 6px !important;
      border-radius: 50% !important;
      display: inline-block !important;
    }

    &.critical {
      background: rgba(211, 47, 47, 0.1) !important;
      color: #d32f2f !important;
      .dot {
        background-color: #d32f2f !important;
      }
    }

    &.high {
      background: rgba(230, 126, 34, 0.1) !important;
      color: #e67e22 !important;
      .dot {
        background-color: #e67e22 !important;
      }
    }

    &.medium {
      background: rgba(241, 196, 15, 0.1) !important;
      color: #f1c40f !important;
      .dot {
        background-color: #f1c40f !important;
      }
    }

    // Refined "Source" Severity Pill - Softer and Muted
    &.source {
      background-color: rgba(66, 133, 244, 0.1) !important;
      color: #7baaf7 !important;
      .dot {
        background-color: #7baaf7 !important;
        opacity: 0.8 !important;
      }
    }
  }

  // --- DATE PILL STYLES ---
  .filter-date-range {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: -1.45em !important;

    .custom-pill-date {
      ::ng-deep {
        .mat-mdc-form-field-notched-outline,
        .mat-mdc-form-field-focus-indicator,
        .mat-mdc-form-field-subscript-wrapper,
        .mdc-notched-outline,
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
          display: none !important;
        }

        .mat-mdc-text-field-wrapper {
          background: transparent !important;
          padding: 0 !important;
          border: none !important;
          box-shadow: none !important;
        }

        .mat-mdc-form-field-flex {
          align-items: center !important;
          padding: 0 !important;
        }

        .mat-mdc-form-field-infix {
          padding: 0 !important;
          min-height: auto !important;
          width: auto !important;
          border-top: none !important;
        }

        .mat-date-range-input-container {
          padding: 0 !important;
          overflow: visible !important;
          display: flex !important;
          align-items: center !important;
          gap: 0 !important;
          border: none !important;
          outline: none !important;
        }

        .mat-date-range-input-wrapper {
          border: 1px solid #e0e0e0 !important;
          background: #ffffff !important;
          border-radius: 6px !important;
          height: 32px !important;
          display: flex !important;
          align-items: center !important;
          padding: 0 10px !important;
          transition: background 0.2s ease !important;
          cursor: pointer !important;
          min-width: 80px !important;
          box-sizing: border-box !important;

          &:hover {
            background: #f5f5f5 !important;
          }

          input {
            background: transparent !important;
            border: none !important;
            color: var(--text-main) !important;
            font-size: 13px !important;
            padding: 0 !important;
            width: 100% !important;
            text-align: center !important;
            outline: none !important;

            &::placeholder {
              color: var(--text-main) !important;
              opacity: 0.5 !important;
            }
          }
        }

        .mat-date-range-input-separator {
          margin: 0 4px !important;
          display: flex !important;
          align-items: center !important;
          color: var(--text-main) !important;
          font-size: 14px !important;
          opacity: 0.7 !important;
        }

        .mat-datepicker-toggle {
          margin-left: 4px !important;
          button {
            width: 32px !important;
            height: 32px !important;
            padding: 0 !important;
            background: transparent !important;
            border: none !important;
            svg {
              width: 19px !important;
              height: 19px !important;
              fill: #818588 !important;
              opacity: 0.7 !important;
            }
          }
        }

        .clear-date-btn {
          width: 28px !important;
          height: 28px !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          mat-icon {
            width: 16px !important;
            height: 16px !important;
            font-size: 16px !important;
            fill: #818588 !important;
            opacity: 0.7 !important;
          }
        }
      }
    }
  }
}

@media (prefers-color-scheme: dark) {
  .rules-tab-wrapper {
    .filter-date-range {
      .custom-pill-date {
        ::ng-deep {
          .mat-date-range-input-wrapper {
            border: 1px solid rgba(255, 255, 255, 0.12) !important;
            background: #1e1e1e !important;
            &:hover {
              background: #2e2e2e !important;
            }
          }
        }
      }
    }
    .status-pill {
      &.active {
        color: #81c784 !important;
        background: rgba(129, 199, 132, 0.15) !important;
      }
      &.draft {
        color: #bdbdbd !important;
        background: rgba(189, 189, 189, 0.1) !important;
      }
      &.archived {
        color: #e57373 !important;
        background: rgba(229, 115, 115, 0.15) !important;
      }
    }
    // Dark mode specific soft blue for Source
    .severity-pill.source {
      background-color: rgba(123, 170, 247, 0.12) !important;
      color: #9dbff9 !important;
      .dot {
        background-color: #9dbff9 !important;
      }
    }
  }
}

.codes-tab-wrapper {
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
  background: transparent !important;

  // --- FIX: First Column Icon and Text Alignment ---
  td.mat-mdc-cell.primary-text.link-style {
    mat-icon.row-icon {
      vertical-align: middle !important;
      font-size: 18px !important;
      width: 18px !important;
      height: 18px !important;
      line-height: 18px !important;
      margin-right: 8px !important;
    }
  }

  // --- STATUS PILL STYLES (Exact Rule Match) ---
  .status-pill {
    display: inline-flex !important;
    padding: 2px 8px !important;
    border-radius: 4px !important;
    font-size: 11px !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.3px !important;

    &.active {
      background: rgba(46, 125, 50, 0.1) !important;
      color: #2e7d32 !important;
    }
    &.draft {
      background: rgba(158, 158, 158, 0.1) !important;
      color: #9e9e9e !important;
    }
    &.archived,
    &.deprecated {
      background: rgba(211, 47, 47, 0.1) !important;
      color: #d32f2f !important;
    }
  }

  // --- SEVERITY PILL STYLES ---
  .severity-pill {
    display: inline-flex !important;
    align-items: center !important;
    padding: 2px 10px !important;
    border-radius: 4px !important;
    font-size: 12px !important;
    font-weight: 500 !important;
    gap: 6px !important;
    width: fit-content !important;

    .dot {
      width: 6px !important;
      height: 6px !important;
      border-radius: 50% !important;
      display: inline-block !important;
    }

    &.critical {
      background: rgba(211, 47, 47, 0.1) !important;
      color: #d32f2f !important;
      .dot {
        background-color: #d32f2f !important;
      }
    }
    &.high {
      background: rgba(230, 126, 34, 0.1) !important;
      color: #e67e22 !important;
      .dot {
        background-color: #e67e22 !important;
      }
    }
    &.medium {
      background: rgba(241, 196, 15, 0.1) !important;
      color: #f1c40f !important;
      .dot {
        background-color: #f1c40f !important;
      }
    }
    &.source {
      background-color: rgba(66, 133, 244, 0.1) !important;
      color: #7baaf7 !important;
      .dot {
        background-color: #7baaf7 !important;
        opacity: 0.8 !important;
      }
    }
  }

  // --- DATE PILL STYLES (Specific necessity styles) ---
  .filter-date-range {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: -1.45em !important;

    .custom-pill-date {
      ::ng-deep {
        .mat-mdc-form-field-notched-outline,
        .mat-mdc-form-field-focus-indicator,
        .mat-mdc-form-field-subscript-wrapper,
        .mdc-notched-outline,
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
          display: none !important;
        }

        .mat-mdc-text-field-wrapper {
          background: transparent !important;
          padding: 0 !important;
          border: none !important;
          box-shadow: none !important;
        }

        .mat-mdc-form-field-flex {
          align-items: center !important;
          padding: 0 !important;
        }

        .mat-mdc-form-field-infix {
          padding: 0 !important;
          min-height: auto !important;
          width: auto !important;
          border-top: none !important;
        }

        .mat-date-range-input-container {
          padding: 0 !important;
          overflow: visible !important;
          display: flex !important;
          align-items: center !important;
          gap: 0 !important;
          border: none !important;
          outline: none !important;
        }

        .mat-date-range-input-wrapper {
          border: 1px solid #e0e0e0 !important;
          background: #ffffff !important;
          border-radius: 6px !important;
          height: 32px !important;
          display: flex !important;
          align-items: center !important;
          padding: 0 10px !important;
          transition: background 0.2s ease !important;
          cursor: pointer !important;
          min-width: 80px !important;
          box-sizing: border-box !important;

          &:hover {
            background: #f5f5f5 !important;
          }

          input {
            background: transparent !important;
            border: none !important;
            color: var(--text-main) !important;
            font-size: 13px !important;
            padding: 0 !important;
            width: 100% !important;
            text-align: center !important;
            outline: none !important;

            &::placeholder {
              color: var(--text-main) !important;
              opacity: 0.5 !important;
            }
          }
        }

        .mat-date-range-input-separator {
          margin: 0 4px !important;
          display: flex !important;
          align-items: center !important;
          color: var(--text-main) !important;
          font-size: 14px !important;
          opacity: 0.7 !important;
        }

        .mat-datepicker-toggle {
          margin-left: 4px !important;
          button {
            width: 32px !important;
            height: 32px !important;
            padding: 0 !important;
            background: transparent !important;
            border: none !important;
            svg {
              width: 19px !important;
              height: 19px !important;
              fill: #818588 !important;
              opacity: 0.7 !important;
            }
          }
        }

        .clear-date-btn {
          width: 28px !important;
          height: 28px !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          mat-icon {
            width: 16px !important;
            height: 16px !important;
            font-size: 16px !important;
            fill: #818588 !important;
            opacity: 0.7 !important;
          }
        }
      }
    }
  }
}

// Dark Mode Support
@media (prefers-color-scheme: dark) {
  .codes-tab-wrapper {
    .filter-date-range .custom-pill-date ::ng-deep .mat-date-range-input-wrapper {
      border: 1px solid rgba(255, 255, 255, 0.12) !important;
      background: #1e1e1e !important;
      &:hover {
        background: #2e2e2e !important;
      }
    }
    .status-pill {
      &.active {
        color: #81c784 !important;
        background: rgba(129, 199, 132, 0.15) !important;
      }
      &.draft {
        color: #bdbdbd !important;
        background: rgba(189, 189, 189, 0.1) !important;
      }
      &.archived {
        color: #e57373 !important;
        background: rgba(229, 115, 115, 0.15) !important;
      }
    }
    .severity-pill.source {
      background-color: rgba(123, 170, 247, 0.12) !important;
      color: #9dbff9 !important;
      .dot {
        background-color: #9dbff9 !important;
      }
    }
  }
}

/* Fix for the record headers */
.card-header {
  display: flex;
  align-items: center; /* Vertically centers all direct children */
  gap: 12px;
  padding: 12px 16px;
  min-height: 56px;

  .header-actions {
    display: flex;
    align-items: center; /* Centers icons and the menu button */
    gap: 4px;
    height: 100%;

    mat-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      cursor: pointer;
      &:hover {
        color: var(--primary-color);
      }
    }

    .mat-mdc-icon-button {
      /* Remove any default margins that push buttons out of alignment */
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toggle {
      margin-left: 8px;
    }
  }
}

// Global cleaning
::ng-deep .mat-mdc-tab-body-content {
  border: none !important;
}

/* Fix for the timeline row items (Added/Edited rows) */
.timeline-row-item {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  gap: 12px;

  mat-icon,
  img {
    flex-shrink: 0;
  }
}

// Combined and Fixed normalization.component.scss

:root {
  --detail-bg: var(--bg-color, #ffffff);
  --detail-text: var(--text-main, #202124);
  --detail-border: var(--border-color, #e0e0e0);
}

@media (prefers-color-scheme: dark) {
  :root {
    --detail-bg: var(--bg-color, #121212);
    --detail-text: var(--text-main, #e8eaed);
    --detail-border: var(--border-color, #3c4043);
  }
}

.normalization-wrapper {
  position: relative;
  width: 100%;
  /* Ensure the wrapper can expand to accommodate absolute children */
  min-height: 100vh;
  background: var(--detail-bg);
  /* Changed to block to prevent flex-basis issues with absolute children */
  display: block;
  overflow-x: hidden;
  /* This ensures the scrollbar belongs to the wrapper */
  overflow-y: auto;
}

.normalization-main-container {
  width: 100%;
  background: var(--detail-bg);
  transition:
    transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.4s ease,
    visibility 0.4s;
  will-change: transform, opacity;

  &.slide-out {
    transform: translateX(-15%);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    /* Remove the container from the height calculation when it's hidden */
    display: none;
  }

  &:not(.slide-out) {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
    display: block;
  }
}

/* THE DETAIL VIEW FIX */
.mapping-detail-view {
  /* Absolute positioning ensures it aligns perfectly to the top: 0 */
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  /* Removed min-height: 100vh to let content define the height */
  height: auto;
  background: var(--detail-bg) !important;
  color: var(--detail-text);
  z-index: 1000;
  /* Ensure padding-bottom so the last row isn't flush with the screen edge */
  padding-bottom: 40px;

  /* Disable internal scroll so the normalization-wrapper handles the scrolling */
  overflow: visible;

  animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.mapping-edit-view {
  /* Absolute positioning ensures it aligns perfectly to the top: 0 */
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  /* Removed min-height: 100vh to let content define the height */
  height: auto;
  background: var(--detail-bg) !important;
  color: var(--detail-text);
  z-index: 1000;
  /* Ensure padding-bottom so the last row isn't flush with the screen edge */
  padding-bottom: 40px;

  /* Disable internal scroll so the normalization-wrapper handles the scrolling */
  overflow: visible;

  animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.slide-out-to-right {
  animation: slideOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

@keyframes slideOutRight {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(100%);
  }
}

.clickable-row {
  cursor: pointer;
  transition: background-color 0.2s ease;

  &:hover {
    background-color: var(--hover-color, rgba(67, 109, 157, 0.08)) !important;
  }

  &.selected-row {
    background-color: var(--selected-color, rgba(63, 81, 181, 0.12)) !important;
  }

  td.mat-cell {
    padding: 12px 8px;
    color: var(--detail-text);
    border-bottom: 1px solid var(--detail-border);
  }
}

.status-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;

  mat-icon {
    font-size: 14px;
    width: 14px;
    height: 14px;
  }

  &.active {
    background: rgba(46, 125, 50, 0.1) !important;
    color: #2e7d32 !important;
  }

  &.deprecated {
    background: rgba(183, 28, 28, 0.1) !important;
    color: #b71c1c !important;
  }
}

@media (prefers-color-scheme: dark) {
  .status-pill {
    &.active {
      background: rgba(129, 199, 132, 0.2) !important;
      color: #81c784 !important;
    }
    &.deprecated {
      background: rgba(239, 83, 80, 0.2) !important;
      color: #ef5350 !important;
    }
  }

  ::ng-deep .mapping-table {
    background: transparent !important;
    .mat-mdc-header-cell {
      background: var(--detail-bg);
      color: var(--detail-text);
      border-bottom: 1px solid var(--detail-border);
    }
  }
}

// Add these styles to your normalization.component.scss:

.normalization-main-container {
  transition:
    transform 0.6s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.6s ease;
  transform-origin: left center;

  &.slide-out {
    transform: translateX(-100%);
    opacity: 0;
    pointer-events: none;
  }

  &.slide-in {
    animation: slideBackIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
}

@keyframes slideBackIn {
  from {
    transform: translateX(-100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

// Wrapper for both views
.normalization-wrapper {
  position: relative;
  overflow: hidden;
  width: 100%;
  min-height: 100vh;
}

.mapping-detail-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  min-height: 100vh;
  background: var(--bg-color);
  z-index: 1000;
  overflow-y: auto;
}

// Add clickable cursor to mapping table rows
.mapping-tab-wrapper {
  .full-width-table {
    tr.clickable-row {
      cursor: pointer;
      transition: background-color 0.2s ease;

      &:hover {
        background-color: rgba(67, 109, 157, 0.05) !important;
      }

      &:active {
        background-color: rgba(67, 109, 157, 0.1) !important;
      }
    }
  }
}

/* 
   MINIMAL TARGETED FIX for Models blank detail view
   Append this block at the END of the file
    */

.model-detail-view,
.model-edit-view {
  position: absolute;
  inset: 0; // top:0; left:0; right:0; bottom:0;
  width: 100%;
  height: 100%; // fills parent container completely
  min-height: 100vh; // safety fallback
  background: var(--detail-bg);
  z-index: 1000;
  overflow-y: auto; // scroll content if needed
  visibility: visible;
  opacity: 1;
  display: block;
  animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* Prevent inner component from collapsing or going off-screen */
.model-detail-view ::ng-deep app-view-model,
.model-edit-view ::ng-deep app-edit-model {
  display: block;
  width: 100%;
  height: 100%;
  min-height: 100%;
}

/* Make model table rows clickable  unchanged, just preserved */
.models-tab-wrapper {
  .full-width-table {
    tr.clickable-row {
      cursor: pointer;
      transition: background-color 0.2s ease;

      &:hover {
        background-color: rgba(67, 109, 157, 0.05) !important;
      }

      &:active {
        background-color: rgba(67, 109, 157, 0.1) !important;
      }

      &.selected-row {
        background-color: rgba(67, 109, 157, 0.12) !important;
      }
    }
  }
}

/* ------------------------------------------------------------------- 
 Adjustment Stlyes for Codes
 --------------------------------------------------------------------- */

/* ------------------------------------------------------------------- 
   CORRECTED CODES TAB STYLES - FULL RESTORATION WITH UNIFORM BUTTONS
   --------------------------------------------------------------------- */

/* Split View Container - Table and Detail Panel Side by Side */
.codes-split-view {
  display: flex;
  width: 100%;
  min-height: 600px;
  background: var(--surface-color);
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  /* Table Section - Shrinks when detail is open */
  .codes-table-section {
    flex: 1 1 100%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;

    .table-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: auto;
    }

    .codes-table {
      width: 100%;
      border-collapse: collapse;

      th,
      td {
        padding: 12px 16px;
        text-align: left;
      }

      th {
        background: var(--bg-color);
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-main);
        opacity: 0.7;
        position: sticky;
        top: 0;
        z-index: 10;
        border-bottom: 1px solid var(--border-color);
      }

      td {
        font-size: 13px;
        color: var(--text-main);
        border-bottom: 1px solid var(--border-color);
      }
    }
  }

  /* When detail panel is open, shrink table */
  &.detail-open {
    .codes-table-section {
      flex: 0 0 60%;
      max-width: 60%;
    }
  }

  /* Detail Panel - Slides in from right */
  .code-detail-panel {
    flex: 0 0 40%;
    max-width: 40%;
    min-width: 450px;
    border-left: 1px solid var(--border-color);
    background: var(--surface-color);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: slideInFromRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    .detail-panel-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-color);
      position: sticky;
      top: 0;
      z-index: 10;

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;

        h3 {
          margin: 0;
          font-size: 14px;
          font-weight: 600;
          color: var(--text-main);
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .header-actions {
          display: flex;
          align-items: center;
          gap: 8px;

          /* UNIFORM EDIT BUTTON - Matched to Edit Mapping Component */
          .edit-btn {
            height: 38px !important;
            background-color: #436d9d !important;
            color: white !important; // Sets text color
            border-radius: 6px;
            font-weight: 500;
            padding: 0 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;

            mat-icon {
              font-size: 18px;
              width: 18px;
              height: 18px;
              margin: 0;
              color: inherit !important; // Forces icon to match text color (white)
            }

            span {
              font-size: 13px;
              line-height: 1;
              color: inherit;
            }

            &:hover {
              filter: brightness(1.1);
            }
          }

          .close-btn {
            flex-shrink: 0;
          }
        }
      }
    }

    .detail-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }
  }
}

/* Code Title Section */
.code-title-section {
  padding-bottom: 20px;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 24px;

  h2 {
    margin: 0 0 12px 0;
    font-size: 18px;
    font-weight: 600;
    color: var(--text-main);
    line-height: 1.4;
  }

  .badge-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;

    .info-badge {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      color: var(--text-main);
      opacity: 0.8;
    }
  }
}

/* Detail Sections */
.detail-section {
  margin-bottom: 28px;

  .section-title {
    margin: 0 0 16px 0;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-main);
    opacity: 0.5;
  }

  &.half-width {
    flex: 1;
    min-width: 0;
  }
}

/* Two Column Layout for Mappings/Crosswalks */
.two-column-section {
  display: flex;
  gap: 24px;
  margin-bottom: 28px;

  @media (max-width: 1200px) {
    flex-direction: column;
  }
}

/* Detail Row Layout (Overview Section) */
.detail-row-layout {
  display: flex;
  gap: 32px;

  .detail-column {
    flex: 1;

    &:first-child {
      flex: 1.5;
    }
  }

  .subsection-title {
    margin: 0 0 12px 0;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-main);
    opacity: 0.7;
  }
}

/* Detail Items */
.detail-item {
  margin-bottom: 16px;

  label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-main);
    opacity: 0.6;
    margin-bottom: 6px;
  }

  .detail-value {
    font-size: 14px;
    color: var(--text-main);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;

    .validated-icon {
      font-size: 16px;
      width: 16px;
      height: 16px;
      color: #2ecc71;
      cursor: help;
    }

    .validated-text {
      font-size: 13px;
      color: var(--text-main);
      opacity: 0.7;

      em {
        font-style: italic;
      }
    }
  }
}

/* Reference List */
.reference-list {
  display: flex;
  flex-direction: column;
  gap: 8px;

  .reference-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--text-main);

    mat-icon {
      font-size: 16px;
      width: 16px;
      height: 16px;
      opacity: 0.5;
    }

    span {
      flex: 1;
    }

    strong {
      color: #5469d4;
      font-weight: 600;
    }
  }
}

/* Mapping List */
.mapping-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 12px;

  .mapping-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 12px;
    color: var(--text-main);
    transition: all 0.2s ease;

    &:hover {
      background: rgba(84, 105, 212, 0.05);
      border-color: #5469d4;
      cursor: pointer;
    }

    .mapping-name {
      font-weight: 600;
      flex: 1;
    }

    .arrow-icon {
      font-size: 16px;
      width: 16px;
      height: 16px;
      opacity: 0.4;
    }

    .mapping-target {
      font-family: 'Roboto Mono', monospace;
      color: #5469d4;
      font-weight: 500;
    }
  }
}

/* Crosswalk List */
.crosswalk-list {
  display: flex;
  flex-direction: column;
  gap: 8px;

  .crosswalk-item {
    padding: 10px 12px;
    background: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 12px;

    .crosswalk-header {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;

      mat-icon {
        font-size: 14px;
        width: 14px;
        height: 14px;
        opacity: 0.5;
      }
    }

    .crosswalk-codes {
      display: flex;
      align-items: center;
      gap: 6px;
      font-family: 'Roboto Mono', monospace;
      color: var(--text-main);
      opacity: 0.7;
      font-size: 11px;
      padding-left: 20px;

      mat-icon {
        font-size: 12px;
        width: 12px;
        height: 12px;
        opacity: 0.4;
      }
    }
  }
}

/* Attribution Grid */
.attribution-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;

  .attribution-item {
    display: flex;
    flex-direction: column;
    gap: 4px;

    label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-main);
      opacity: 0.6;
    }

    span {
      font-size: 13px;
      color: var(--text-main);
    }
  }
}

/* View All Link */
.view-all-link {
  width: 100%;
  justify-content: flex-start;
  color: #5469d4 !important;
  font-weight: 500;
  font-size: 13px;
  height: 36px;
  margin-top: 4px;

  mat-icon {
    margin-left: auto;
    font-size: 18px;
    width: 18px;
    height: 18px;
  }

  &:hover {
    background: rgba(84, 105, 212, 0.05) !important;
  }
}

/* Slide-in Animation */
@keyframes slideInFromRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Table Column Widths - LOCKED (35% Meaning, 12% Mapped To) */
.codes-table {
  th,
  td {
    &:nth-child(1) {
      width: 18%;
    } /* Code/Set Name */
    &:nth-child(2) {
      width: 13%;
    } /* System */
    &:nth-child(3) {
      width: 35%;
    } /* Meaning */
    &:nth-child(4) {
      width: 9%;
      text-align: center;
    } /* Version */
    &:nth-child(5) {
      width: 11%;
    } /* Status */
    &:nth-child(6) {
      width: 12%;
    } /* Mapped To */
    &:nth-child(7) {
      width: 2%;
      text-align: right;
    } /* Actions */
  }
}

/* Clickable Rows - CLEAN OPEN STATE (No Background Overrides) */
.codes-table {
  .clickable-row {
    cursor: pointer;
    transition: background-color 0.2s ease;

    &:hover td {
      background-color: rgba(84, 105, 212, 0.05) !important;
    }

    &.selected-row td {
      background-color: transparent !important;
      font-weight: 600;
      border-left: none !important;
    }
  }

  .meaning-cell {
    font-size: 13px;
    color: var(--text-main);
    line-height: 1.4;
  }

  .version-cell {
    text-align: center;
    font-weight: 500;
  }

  .mapped-to-cell {
    font-size: 12px;
    color: var(--text-main);
    opacity: 0.8;
    font-family: 'Roboto Mono', monospace;
  }
}

/* Status Pills */
.status-pill {
  display: inline-flex !important;
  align-items: center !important;
  padding: 4px 10px !important;
  border-radius: 4px !important;
  font-size: 11px !important;
  font-weight: 600 !important;
  text-transform: capitalize !important;
  letter-spacing: 0.3px !important;
  white-space: nowrap !important;

  &.active {
    background: rgba(46, 125, 50, 0.1) !important;
    color: #2e7d32 !important;
  }

  &.superseded {
    background: rgba(255, 152, 0, 0.1) !important;
    color: #f57c00 !important;
  }

  &.deprecated {
    background: rgba(211, 47, 47, 0.1) !important;
    color: #d32f2f !important;
  }

  &.invalid {
    background: rgba(158, 158, 158, 0.1) !important;
    color: #9e9e9e !important;
  }
}

/* Responsive Adjustments */
@media (max-width: 1600px) {
  .codes-split-view.detail-open {
    .codes-table-section {
      flex: 0 0 55%;
      max-width: 55%;
    }

    .code-detail-panel {
      flex: 0 0 45%;
      max-width: 45%;
    }
  }
}

@media (max-width: 1400px) {
  .codes-split-view.detail-open {
    .codes-table-section {
      flex: 0 0 50%;
      max-width: 50%;
    }

    .code-detail-panel {
      flex: 0 0 50%;
      max-width: 50%;
      min-width: 400px;
    }
  }

  .detail-row-layout {
    flex-direction: column;
  }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  .code-detail-panel {
    .detail-panel-header {
      h3 {
        color: #e8eaed;
      }
    }

    .code-title-section {
      h2 {
        color: #e8eaed;
      }
      .info-badge {
        background: #2e2e2e;
        border-color: rgba(255, 255, 255, 0.12);
        color: #e8eaed;
      }
    }
  }
}

/* Code Edit View - Full Overlay */
.code-edit-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  min-height: 100vh;
  background: var(--detail-bg);
  z-index: 2000; /* Above detail panel (100) */
  overflow-y: auto;
  animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;

  ::ng-deep app-edit-code {
    display: block;
    width: 100%;
    height: 100%;
    min-height: 100%;
  }
}

/* Ensure slideInRight/slideOutRight animations exist */
@keyframes slideInRight {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

@keyframes slideOutRight {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(100%);
  }
}

// ============================================================================
// APPEND TO END OF normalization.component.scss
// - Fix for edit-code: Main container slides fully left (-100%) when edit-code opens
// - Matches view-model/view-mapping: main collapses left, edit slides in right
// - Uses existing slide-out-to-left class (or define if missing)
// - No override of other animations, only adds trigger logic
// ============================================================================

.normalization-main-container {
  // Ensure transition is smooth for all slide cases
  transition:
    transform 0.5s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.5s ease;

  // Stronger slide-out: full -100% to fully collapse left
  &.slide-out-to-left {
    transform: translateX(-100%) !important;
    opacity: 1 !important; // Keep opacity 1 to avoid transparency
    pointer-events: none !important;
  }
}

// Edit code view - ensure it slides in from right (append if missing)
.code-edit-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-color);
  z-index: 2000; // Above main (0) and other details (1000)
  overflow-y: auto;
  animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

// Reinforce slideInRight keyframe (if not already defined)
@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

// Rule Detail & Edit Views
.rule-detail-view,
.rule-edit-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: auto;
  min-height: 100vh;
  background: var(--detail-bg) !important;
  color: var(--detail-text);
  z-index: 1000;
  padding-bottom: 40px;
  overflow: visible;
  animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.rule-edit-view {
  z-index: 2000; // Above detail view
}

// Ensure inner components don't collapse
.rule-detail-view ::ng-deep app-view-rule,
.rule-edit-view ::ng-deep app-edit-rule {
  display: block;
  width: 100%;
  height: 100%;
  min-height: 100%;
}

// Make rule table rows clickable
.rules-tab-wrapper {
  .full-width-table {
    tr.clickable-row {
      cursor: pointer;
      transition: background-color 0.2s ease;

      &:hover {
        background-color: rgba(67, 109, 157, 0.05) !important;
      }

      &:active {
        background-color: rgba(67, 109, 157, 0.1) !important;
      }

      &.selected-row {
        background-color: rgba(67, 109, 157, 0.12) !important;
      }
    }
  }
}

// Map Code Set View - Full Overlay
.map-code-set-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-color);
  z-index: 2000; // Above main (0), details (1000), and edit-code (2000)
  overflow-y: auto;
  animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

// Ensure inner component doesn't collapse
.map-code-set-view ::ng-deep app-map-code-set {
  display: block;
  width: 100%;
  height: 100%;
  min-height: 100%;
}

/* 
   CODE SET MAPPING DRAWER - CORRECT APPROACH
   
   This should work like code-detail-panel in Codes tab:
   - NOT position: fixed
   - Part of a split-view within the Mappings tab
   - Slides in from right within the tab container
   - Does NOT overlay the entire viewport
    */

/* Wrapper for the Mappings tab to enable split view */
.mappings-split-view {
  display: flex;
  width: 100%;
  min-height: 600px;
  background: var(--surface-color);
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  /* Table section - shrinks when detail is open */
  .mappings-table-section {
    flex: 1 1 100%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;

    .table-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: auto;
    }
  }

  /* When detail panel is open, shrink table */
  &.detail-open {
    .mappings-table-section {
      flex: 0 0 60%;
      max-width: 60%;
    }
  }

  /* Code set mapping detail panel - slides in from right WITHIN the tab */
  .code-set-mapping-detail-panel {
    /* RELATIVE positioning - stays within parent container */
    position: relative;
    flex: 0 0 40%;
    max-width: 40%;
    min-width: 450px;
    border-left: 1px solid var(--border-color);
    background: var(--surface-color);
    display: flex;
    flex-direction: column;
    overflow: hidden;

    /* Animation - slides in from right */
    animation: slideInFromRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    /* Header - exact match to code-detail-panel */
    .detail-panel-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-color);
      position: sticky;
      top: 0;
      z-index: 10;

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;

        h3 {
          margin: 0;
          font-size: 14px;
          font-weight: 600;
          color: var(--text-main);
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .header-actions {
          display: flex;
          align-items: center;
          gap: 8px;

          /* Edit button - primary blue like code-detail-panel */
          .edit-btn {
            height: 38px !important;
            background-color: #436d9d !important;
            color: white !important;
            border-radius: 6px;
            font-weight: 500;
            padding: 0 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;

            mat-icon {
              font-size: 18px;
              width: 18px;
              height: 18px;
              margin: 0;
              color: inherit !important;
            }

            span {
              font-size: 13px;
              line-height: 1;
              color: inherit;
            }

            &:hover {
              filter: brightness(1.1);
            }
          }

          .close-btn {
            flex-shrink: 0;
          }
        }
      }
    }

    .detail-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    /* All detail sections - exact match to code-detail-panel */
    .code-title-section {
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 24px;

      h2 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--text-main);
        line-height: 1.4;
      }

      .badge-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;

        .info-badge {
          padding: 4px 10px;
          border-radius: 4px;
          font-size: 11px;
          font-weight: 600;
          background: var(--bg-color);
          border: 1px solid var(--border-color);
          color: var(--text-main);
          opacity: 0.8;
        }
      }
    }

    .detail-section {
      margin-bottom: 28px;

      .section-title {
        margin: 0 0 16px 0;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        color: var(--text-main);
        opacity: 0.5;
      }

      &.half-width {
        flex: 1;
        min-width: 0;
      }
    }

    .two-column-section {
      display: flex;
      gap: 24px;
      margin-bottom: 28px;

      @media (max-width: 1200px) {
        flex-direction: column;
      }
    }

    .detail-row-layout {
      display: flex;
      gap: 32px;

      .detail-column {
        flex: 1;

        &:first-child {
          flex: 1.5;
        }
      }

      .subsection-title {
        margin: 0 0 12px 0;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-main);
        opacity: 0.7;
      }
    }

    .detail-item {
      margin-bottom: 16px;

      label {
        display: block;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-main);
        opacity: 0.6;
        margin-bottom: 6px;
      }

      .detail-value {
        font-size: 14px;
        color: var(--text-main);
        font-weight: 500;
      }
    }

    .reference-list {
      display: flex;
      flex-direction: column;
      gap: 8px;

      .reference-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--text-main);

        mat-icon {
          font-size: 16px;
          width: 16px;
          height: 16px;
          opacity: 0.5;
        }

        span {
          flex: 1;
        }

        strong {
          color: #5469d4;
          font-weight: 600;
        }
      }
    }

    .mapping-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;

      .mapping-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-main);
        transition: all 0.2s ease;

        &:hover {
          background: rgba(84, 105, 212, 0.05);
          border-color: #5469d4;
          cursor: pointer;
        }

        .mapping-name {
          font-weight: 600;
          flex: 1;
        }

        .arrow-icon {
          font-size: 16px;
          width: 16px;
          height: 16px;
          opacity: 0.4;
        }

        .mapping-target {
          font-family: 'Roboto Mono', monospace;
          color: #5469d4;
          font-weight: 500;
        }
      }
    }

    .crosswalk-list {
      display: flex;
      flex-direction: column;
      gap: 8px;

      .crosswalk-item {
        padding: 10px 12px;
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 12px;

        .crosswalk-header {
          display: flex;
          align-items: center;
          gap: 6px;
          font-weight: 600;
          color: var(--text-main);
          margin-bottom: 4px;

          mat-icon {
            font-size: 14px;
            width: 14px;
            height: 14px;
            opacity: 0.5;
          }
        }

        .crosswalk-codes {
          display: flex;
          align-items: center;
          gap: 6px;
          font-family: 'Roboto Mono', monospace;
          color: var(--text-main);
          opacity: 0.7;
          font-size: 11px;
          padding-left: 20px;

          mat-icon {
            font-size: 12px;
            width: 12px;
            height: 12px;
            opacity: 0.4;
          }
        }
      }
    }

    .attribution-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;

      .attribution-item {
        display: flex;
        flex-direction: column;
        gap: 4px;

        label {
          font-size: 11px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          color: var(--text-main);
          opacity: 0.6;
        }

        span {
          font-size: 13px;
          color: var(--text-main);
        }
      }
    }

    .view-all-link {
      width: 100%;
      justify-content: flex-start;
      color: #5469d4 !important;
      font-weight: 500;
      font-size: 13px;
      height: 36px;
      margin-top: 4px;

      mat-icon {
        margin-left: auto;
        font-size: 18px;
        width: 18px;
        height: 18px;
      }

      &:hover {
        background: rgba(84, 105, 212, 0.05) !important;
      }
    }

    .error-message {
      color: #d32f2f;
      padding: 16px;
      text-align: center;
      font-size: 14px;
    }

    .loading-message {
      padding: 16px;
      text-align: center;
      color: var(--text-main);
      opacity: 0.6;
    }
  }
}

/* Slide-in animation */
@keyframes slideInFromRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Responsive adjustments */
@media (max-width: 1600px) {
  .mappings-split-view.detail-open {
    .mappings-table-section {
      flex: 0 0 55%;
      max-width: 55%;
    }

    .code-set-mapping-detail-panel {
      flex: 0 0 45%;
      max-width: 45%;
    }
  }
}

@media (max-width: 1400px) {
  .mappings-split-view.detail-open {
    .mappings-table-section {
      flex: 0 0 50%;
      max-width: 50%;
    }

    .code-set-mapping-detail-panel {
      flex: 0 0 50%;
      max-width: 50%;
      min-width: 400px;
    }
  }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .code-set-mapping-detail-panel {
    .detail-panel-header {
      h3 {
        color: #e8eaed;
      }
    }

    .code-title-section {
      h2 {
        color: #e8eaed;
      }
      .info-badge {
        background: #2e2e2e;
        border-color: rgba(255, 255, 255, 0.12);
        color: #e8eaed;
      }
    }

    .mapping-item,
    .crosswalk-item {
      background: #2e2e2e;
      border-color: rgba(255, 255, 255, 0.12);

      &:hover {
        background: rgba(84, 105, 212, 0.1);
      }
    }
  }
}

/* 
   MAPPINGS SPLIT-VIEW & DETAIL DRAWER
    */

.mappings-split-view {
  display: flex;
  width: 100%;
  min-height: 600px;
  background: var(--surface-color);
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  .mappings-table-section {
    flex: 1 1 100%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;

    .table-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: auto;
    }
  }

  /* Shrink table when detail panel is open */
  &.detail-open {
    .mappings-table-section {
      flex: 0 0 55%;
      max-width: 55%;
    }
  }

  .code-detail-panel {
    position: relative;
    flex: 0 0 45%;
    max-width: 45%;
    min-width: 450px;
    border-left: 1px solid var(--border-color);
    background: var(--surface-color);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.05);
    animation: slideInFromRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    .detail-panel-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-color);
      position: sticky;
      top: 0;
      z-index: 10;

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;

        h3 {
          margin: 0;
          font-size: 14px;
          font-weight: 600;
          color: var(--text-main);
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .header-actions {
          display: flex;
          align-items: center;
          gap: 8px;

          .edit-btn {
            height: 36px !important;
            background-color: #436d9d !important; // Correct blue
            color: white !important;
            border-radius: 6px;
            padding: 0 16px;
            font-size: 13px;

            mat-icon {
              font-size: 18px;
              width: 18px;
              height: 18px;
              margin-right: 4px;
            }
          }
        }
      }
    }

    .detail-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .detail-section {
      margin-bottom: 32px;
      .section-title {
        margin: 0 0 16px 0;
        font-size: 11px;
        font-weight: 700;
        color: var(--text-main);
        opacity: 0.5;
        letter-spacing: 1px;
      }
    }

    .detail-row-layout {
      display: flex;
      gap: 32px;
      .detail-column {
        flex: 1;
      }
    }

    .detail-item {
      margin-bottom: 16px;
      label {
        display: block;
        font-size: 11px;
        font-weight: 600;
        color: var(--text-main);
        opacity: 0.5;
        margin-bottom: 4px;
      }
      .detail-value {
        font-size: 14px;
        font-weight: 500;
      }
    }

    .mapping-item,
    .crosswalk-item {
      padding: 12px;
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;

      .mapping-name {
        font-weight: 600;
        flex: 1;
      }
      .mapping-target {
        color: #436d9d;
        font-family: monospace;
      }
      .arrow-icon {
        opacity: 0.3;
        font-size: 16px;
        width: 16px;
        height: 16px;
      }
    }

    .attribution-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      .attribution-item {
        display: flex;
        gap: 8px;
        font-size: 13px;
        label {
          font-weight: 600;
          opacity: 0.6;
        }
      }
    }
  }
}

@keyframes slideInFromRight {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

/* 
   VIEW CODE SET & MIXED MAPPING  EXACT PATTERN
   Parent slides left, view appears full-screen contained
    */

.normalization-wrapper {
  position: relative;
  overflow: hidden; // critical: contains fixed children + prevents scrollbar leaks
  width: 100%;
  min-height: 100vh;
  background: var(--detail-bg);
}

.normalization-main-container {
  transition:
    transform 0.5s cubic-bezier(0.32, 0.72, 0, 1),
    opacity 0.5s ease;
  will-change: transform, opacity;

  /* When ANY detail view opens (CodeSet, Mixed, or others) */
  &.detail-open {
    transform: translateX(-100%);
    opacity: 1;
    pointer-events: none;
  }

  /* When returning from detail/edit */
  &.detail-return {
    animation: slideBackIn 0.5s cubic-bezier(0.32, 0.72, 0, 1) forwards;
  }
}

/* Fixed views contained by wrapper */
.view-code-set-mapping-view,
.view-mixed-mapping-view {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1000; // same level as model-detail-view
  background: var(--detail-bg);
  overflow: hidden; // host overflow hidden, scroll inside child
}

/* Scroll container inside mapping views */
.mapping-detail-scroll-container {
  height: 100%;
  width: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  &::-webkit-scrollbar {
    width: 6px;
  }
  &::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
  }
}

/* Reinforce shared keyframes */
@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOutRight {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}

@keyframes slideBackIn {
  from {
    transform: translateX(-100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Edit views opening from detail views */
.edit-code-set-mapping-view,
.edit-mixed-mapping-view {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 2000; // above view
  background: var(--detail-bg);
  overflow: hidden;
  animation: slideInRight 0.5s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}

/* 
   SLIDE BEHAVIOR FOR ALL DETAIL / EDIT VIEWS
    */

.normalization-main-container {
  /* Base transition  must be smooth for slide */
  transition:
    transform 0.55s cubic-bezier(0.32, 0.72, 0, 1),
    opacity 0.55s ease;
  will-change: transform, opacity;

  /* When ANY detail or edit view is shown  slide FULLY left */
  &.slide-out-to-left {
    transform: translateX(-100%) !important;
    opacity: 1;
    pointer-events: none !important;
  }
}

/* View containers  slides in from right when shown */
.view-code-set-mapping-view,
.view-mixed-mapping-view,
.model-detail-view,
.rule-detail-view,
.mapping-detail-view,
.code-set-detail-view,
.mixed-detail-view,
.map-code-set-view {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 1100;
  background: var(--bg-color);
  overflow-y: auto;
  overflow-x: hidden;

  /* Entrance animation */
  animation: slideInFromRight 0.55s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}

/* Edit views  higher z-index, same slide-in */
.edit-code-set-mapping-view,
.edit-mixed-mapping-view,
.model-edit-view,
.rule-edit-view,
.mapping-edit-view,
.code-edit-view {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 2000;
  background: var(--bg-color);
  overflow-y: auto;
  animation: slideInFromRight 0.55s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}

/* Closing animation  slide out to right */
.slide-out-to-right {
  animation: slideOutToRight 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;
}

@keyframes slideInFromRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOutToRight {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}
